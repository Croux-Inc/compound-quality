{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/croux-inc/compound-quality/schemas/compound-quality.schema.json",
  "title": "Compound Quality Config",
  "type": "object",
  "required": ["version", "commands", "coverage"],
  "properties": {
    "version": { "type": "number" },
    "qualityDir": { "type": "string" },
    "commands": {
      "type": "object",
      "required": ["typecheck", "lint", "test", "build"],
      "properties": {
        "typecheck": { "type": "string" },
        "lint": { "type": "string" },
        "test": { "type": "string" },
        "build": { "type": "string" }
      },
      "additionalProperties": true
    },
    "coverage": {
      "type": "object",
      "required": ["packageDirs"],
      "properties": {
        "packageDirs": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "summaryFile": { "type": "string" },
        "expectedPackages": { "type": "number" }
      },
      "additionalProperties": true
    },
    "patterns": {
      "type": "object",
      "properties": {
        "claudeRuleThreshold": { "type": "number" },
        "lintRuleThreshold": { "type": "number" },
        "rules": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["key", "pattern"],
            "properties": {
              "key": { "type": "string" },
              "pattern": { "type": "string" },
              "flags": { "type": "string" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": true
    },
    "weights": {
      "type": "object",
      "properties": {
        "typeSafety": { "type": "number" },
        "testHealth": { "type": "number" },
        "lintCompliance": { "type": "number" },
        "coverageLevel": { "type": "number" },
        "buildStability": { "type": "number" }
      },
      "additionalProperties": true
    },
    "maxSuggestedUpdateFiles": { "type": "number" },
    "verify": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "policyPacks": {
          "type": "array",
          "items": { "type": "string" }
        },
        "requiredTaskEvidence": { "type": "boolean" },
        "taskIdPattern": { "type": "string" },
        "taskIdSources": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["cli", "env", "branch"]
          }
        },
        "envTaskIdVar": { "type": "string" },
        "doneEvidenceDir": { "type": "string" },
        "evidenceSchemaFile": { "type": "string" },
        "waiversFile": { "type": "string" },
        "gates": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "type"],
            "properties": {
              "id": { "type": "string" },
              "type": {
                "type": "string",
                "enum": ["command", "custom_script", "file_exists", "json_schema", "regex"]
              },
              "required": { "type": "boolean" },
              "enabled": { "type": "boolean" },
              "forEachTaskId": { "type": "boolean" },
              "command": { "type": "string" },
              "path": { "type": "string" },
              "paths": {
                "type": "array",
                "items": { "type": "string" }
              },
              "schemaFile": { "type": "string" },
              "dataFile": { "type": "string" },
              "file": { "type": "string" },
              "pattern": { "type": "string" },
              "flags": { "type": "string" },
              "minMatches": { "type": "number" }
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
